<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premier League Table</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f0f2f5; }
        .card { margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .table thead { background-color: #37003c; color: white; }
        .match { padding: 10px; border-bottom: 1px solid #eee; }
        .badge { background-color: #00ff87; color: #37003c; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4" style="color: #37003c;">Premier League Tracker</h1>
        
        <!-- League Table -->
        <div class="card">
            <div class="card-header">
                <h3>Current Standings</h3>
            </div>
            <div class="card-body">
                <table class="table" id="leagueTable">
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Team</th>
                            <th>GP</th>
                            <th>W</th>
                            <th>D</th>
                            <th>L</th>
                            <th>GD</th>
                            <th>Pts</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Matches Section -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3>Recent Results</h3>
                    </div>
                    <div class="card-body" id="recentResults"></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3>Upcoming Fixtures</h3>
                    </div>
                    <div class="card-body" id="upcomingFixtures"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function fetchWithProxy(url) {
            try {
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
                const response = await fetch(proxyUrl);
                const data = await response.json();
                return new DOMParser().parseFromString(data.contents, "text/html");
            } catch (error) {
                console.error('Error:', error);
                return null;
            }
        }

        async function updateLeagueTable() {
            const html = await fetchWithProxy('https://www.premierleague.com/tables');
            if (!html) return;

            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            const rows = html.querySelectorAll('.table-row-container:not(.expandable)');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const team = row.querySelector('.team').textContent.trim();
                
                const rowHTML = `
                    <tr>
                        <td>${cells[1].textContent}</td>
                        <td>${team}</td>
                        <td>${cells[2].textContent}</td>
                        <td>${cells[3].textContent}</td>
                        <td>${cells[4].textContent}</td>
                        <td>${cells[5].textContent}</td>
                        <td>${cells[9].textContent}</td>
                        <td><strong>${cells[10].textContent}</strong></td>
                    </tr>
                `;
                tableBody.innerHTML += rowHTML;
            });
        }

        async function updateMatches(section, elementId) {
            const html = await fetchWithProxy('https://www.premierleague.com/results');
            if (!html) return;

            const container = document.getElementById(elementId);
            container.innerHTML = '';

            const matches = html.querySelectorAll('.matchList');
            matches.forEach(match => {
                const date = match.querySelector('.date').textContent;
                const teams = match.querySelectorAll('.team');
                const score = match.querySelector('.score')?.textContent || '<span class="badge">vs</span>';

                const matchHTML = `
                    <div class="match">
                        <div class="d-flex justify-content-between">
                            <div>
                                <small>${date}</small><br>
                                ${teams[0].textContent} vs ${teams[1].textContent}
                            </div>
                            <div class="score">${score}</div>
                        </div>
                    </div>
                `;
                container.innerHTML += matchHTML;
            });
        }

        async function updateAllData() {
            await updateLeagueTable();
            await updateMatches('results', 'recentResults');
            await updateMatches('fixtures', 'upcomingFixtures');
        }

        // Initial load
        updateAllData();
        // Update every 10 minutes
        setInterval(updateAllData, 600000);
    </script>
</body>
</html>
